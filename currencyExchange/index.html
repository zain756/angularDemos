<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
	<title>Angular App</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">	
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.js"></script>
	<script src="https://use.fontawesome.com/99ebb0d30d.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-resource/1.4.8/angular-resource.js"></script>  
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.0/css/bootstrap-select.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.0/js/bootstrap-select.min.js"></script>
	<style>
		.jumbotron{
			//background-color: #545453;
			//color:white;
			max-height:100px;
			padding-top: 1px;
			margin-bottom: 10px;
		}
		
		.select{
			height:50px;
		}
		

	</style>
</head>
<body>
	<div  class = "container" ng-controller="myCtrl">
		<div class = "row" >
			<div class = "jumbotron text-center">
				<h1>Live Currency Data</h1>
			</div>
			<div class = "col-sm-offset-3">
				<form class="form-horizontal userForm" name = "form" novalidate>
					<div class="form-group">
						<label class="control-label col-sm-2" for="sourceCurr">From :</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="sourceCurr" 
								   placeholder="US Dollar" ng-model = "input.sourceCurr" name = "country"  value = "US Dollar"disabled>
						</div><!--
						<div class="col-sm-4">
							<div ng-show="form.$submitted || form.country.$touched">
								<div ng-show="form.country.$error.required"><i>Please Enter Country.</i></div>
							</div>
						</div>-->
					</div>
					<!--
					<div class="form-group">
						<label class="control-label col-sm-2" for="targetCurr">To :</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="targetCurr" 
								   placeholder="target currency" ng-model = "input.targetCurr">
								
								
						</div>
					</div>
					-->
					
					<div class="form-group">
						<label class="control-label col-sm-2" for="targetCurr">Select :</label>
						<div class="col-sm-4">
							<select ng-model="input.targetCurr" ng-options="x for x  in currencyCodes" >
							</select>
									
								
						</div>
					</div>
					
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-3">
							<button type="submit" class="btn btn-primary btn-lg" ng-click = "getRate(input)" >
								
								Get Rates
								 <span ng-if = "showLoadingIcon"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>
								 <span class="sr-only">Loading...</span></span>
								 </button>
								
						</div>
					</div>
		   
				</form>
			
			
				
		    </div>
		</div>
		
		
		<div class = "row" ng-if = "showResults">	
			<div class = "col-sm-12 text-center">
				<h3> {{result}} {{input.targetCurr}}</h3>
			</div>
		</div>	
		<p>{{input.targetCurr}}</p>
		
	</div>
<!--
Angular js code
-->
<script>
var app = angular.module('myApp', []);
app.constant('apikey','7111b06a719a7143768c344884da9962');
app.constant ('baseURL1', 'http://www.apilayer.net/api/live');
app.constant ('baseURL2', 'http://www.apilayer.net/api/list');

//factory
app.factory('currencyApiFactory', ['$http', 'baseURL1','baseURL2', 'apikey', function($http, baseURL1, baseURL2, apikey){
	var currencyFactory = {};
	var currencyRates = {};
	var params = {
			access_key : apikey,
			format : 1
			};
	var refresh = function(){
		
			$http.get(baseURL1,{params: params}).then(
				function(response){
					console.log(response.data);
					currencyRates = response.data.quotes;
				

					
			});
			/*
			$http.get(baseURL2,{params: params}).then(
				function(response){
					console.log(response.data);
					currencyFactory.currencyCodes = response.data.currencies;
					
			});
			*/
	};
	refresh();
	
	currencyFactory.getRate = function(input){
		console.log(currencyRates["USD" + input]);
		return currencyRates["USD" + input];
	};
	
	currencyFactory.getCodes = function(){
		return $http.get(baseURL2,{params: params});
	};
	
	return currencyFactory;
}]);
//controller
app.controller('myCtrl',['$scope', 'currencyApiFactory' ,function($scope, currencyApiFactory) {
    
   $scope.showResults = false;
	$scope.showLoadingIcon = false;
	$scope.currencyCodes = [];
	var getCurrencyCodes = function(){
		currencyApiFactory.getCodes().then(
				function(response){
					console.log(response.data);
					for(var key in response.data.currencies){
						$scope.currencyCodes.push(key);
				  }
					//$scope.currencyCodes = response.data.currencies;
					
			});
	};
	getCurrencyCodes();
	
	console.log(currencyApiFactory.currencyCodes);
	$scope.getRate = function (input){
		console.log(input.targetCurr);
		 $scope.result = currencyApiFactory.getRate(input.targetCurr);
		 $scope.showResults = true;
	};

	
}]);
</script>

</body>
</html>