<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
	<title>Angular App</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">	
	<!--
	<script src="https://use.fontawesome.com/99ebb0d30d.js"></script>-->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-resource/1.4.8/angular-resource.js"></script>  
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.0/css/bootstrap-select.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.0/js/bootstrap-select.min.js"></script>
	<script src="currencyCodes.js"></script>
	<style>
		.jumbotron{
			background-color: #F8A900;
			//color:white;
			max-height:100px;
			padding-top: 1px;
			margin-bottom: 10px;
		}
		
		select{
			height:30px;
			width :160px;
		}
		
		.currBox {
			height:100px;
			background-color: #646464;
			margin:5px;
			padding-top:10px;
			border-radius:7px;
			color: #FFAE00;
		}
		
		
		

	</style>
</head>
<body>
	<div class = "container">
		<div class = "row" >
			<div class = "jumbotron text-center">
				<h1>Live Currency Data</h1>
			</div>
		</DIV>	
	</div>
	<div ng-controller = "ratesViewCtrl">
		
		<div box-view></div>
	</div>
	
	<div  class = "container" ng-controller="myCtrl" >
		<div class = "row" >
			<hr>
			<h3> Currency Conversion</h3>
			<div class = "col-sm-offset-0">
				<form class="form-horizontal userForm" name = "form" novalidate>
					<div class="form-group">
						<label class="control-label col-sm-2" for="sourceCurr">From :</label>
						<div class="col-sm-3">
							<select ng-model="input.sourceCurr" ng-options="k as v for (k,v) in selectCurrencyCodes" required >
							</select>
						</div>
						<!--
						<div class="col-sm-4">
							<div ng-show="form.$submitted || form.country.$touched">
								<div ng-show="form.country.$error.required"><i>Please Enter Country.</i></div>
							</div>
						</div>-->
					</div>
					
					
					<div class="form-group">
						<label class="control-label col-sm-2" for="targetCurr"> To:</label>
						<div class="col-sm-3">
							<select ng-model="input.targetCurr" ng-options="k as v for (k,v)  in selectCurrencyCodes" required>
							</select>
						
						</div>
					</div>
					
					
					<div class="form-group">
						<label class="control-label col-sm-2" for="amount">Amount :</label>
						<div class="col-sm-2">
							<input type="number"  class="form-control" id="amount" 
								   placeholder="Enter Amount" ng-model = "input.amount" required>
								
								
						</div>
					</div>
					
					
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-3">
							<button type="submit" class="btn btn-primary btn-lg" ng-click = "getRate(input)" ng-disabled="form.$invalid" >
								
								Get Rates
								 <span ng-if = "showLoadingIcon"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>
								 <span class="sr-only">Loading...</span></span>
								 </button>
								
						</div>
						
						
					</div>
		   
				</form>
			
			
				
		    </div>
		</div>
		
		
		<div class = "row" ng-if = "showResults">	
			<div class = "well col-sm-3 col-sm-offset-2">
				<h3> {{input.targetCurr}} {{result}} </h3>
			</div>
		</div>	
		
		
	</div>
	

	
<!--
Angular js code
-->
<script>
var app = angular.module('myApp', []);
app.constant('apikey','7111b06a719a7143768c344884da9962');
app.constant ('baseURL1', 'http://www.apilayer.net/api/live');
app.constant ('baseURL2', 'http://www.apilayer.net/api/list');

//factory
app.factory('currencyApiFactory', ['$http', 'baseURL1','baseURL2', 'apikey', function($http, baseURL1, baseURL2, apikey){
	var currencyFactory = {};
	var currencyRates = {};
	var params = {
			access_key : apikey,
			format : 1
			};
	var refresh = function(){
		
			$http.get(baseURL1,{params: params}).then(
				function(response){
					console.log(response.data);
					currencyRates = response.data.quotes;
				

					
			});
			/*
			$http.get(baseURL2,{params: params}).then(
				function(response){
					console.log(response.data);
					currencyFactory.currencyCodes = response.data.currencies;
					
			});
			*/
	};
	refresh();
	
	
	
	currencyFactory.getRate = function(input){
		console.log(currencyRates["USD" + input]);
		return currencyRates["USD" + input];
	};
	
	currencyFactory.getRates = function(input){
		//console.log(currencyRates["USD" + input]);
		return $http.get(baseURL1, {params: params});
	};
	
	currencyFactory.getCodes = function(){
		return $http.get(baseURL2,{params: params});
	};
	
	
	
	return currencyFactory;
}]);

app.factory('timeConvertFactory', function(){
	
		var timeFact = {};
		timeFact.convert = function(input){
			// Create a new JavaScript Date object based on the timestamp
			// multiplied by 1000 so that the argument is in milliseconds, not seconds.
			var date = new Date(input*1000);
			// Hours part from the timestamp
			var hours = date.getHours();
			// Minutes part from the timestamp
			var minutes = "0" + date.getMinutes();
			// Seconds part from the timestamp
			var seconds = "0" + date.getSeconds();

			// Will display time in 10:30:23 format
			var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
			return formattedTime;
		
		}
		return timeFact;
});


app.factory('currencyCodesFactory', function(){
	var currencyArr = {
    "AED":"United Arab Emirates Dirham",
    "AFN":"Afghan Afghani",
    "ALL":"Albanian Lek",
    "AMD":"Armenian Dram",
    "ANG":"Netherlands Antillean Guilder",
    "AOA":"Angolan Kwanza",
    "ARS":"Argentine Peso",
    "AUD":"Australian Dollar",
    "AWG":"Aruban Florin",
    "AZN":"Azerbaijani Manat",
    "BAM":"Bosnia-Herzegovina Convertible Mark",
    "BBD":"Barbadian Dollar",
    "BDT":"Bangladeshi Taka",
    "BGN":"Bulgarian Lev",
    "BHD":"Bahraini Dinar",
    "BIF":"Burundian Franc",
    "BMD":"Bermudan Dollar",
    "BND":"Brunei Dollar",
    "BOB":"Bolivian Boliviano",
    "BRL":"Brazilian Real",
    "BSD":"Bahamian Dollar",
    "BTC":"Bitcoin",
    "BTN":"Bhutanese Ngultrum",
    "BWP":"Botswanan Pula",
    "BYR":"Belarusian Ruble",
    "BZD":"Belize Dollar",
    "CAD":"Canadian Dollar",
    "CDF":"Congolese Franc",
    "CHF":"Swiss Franc",
    "CLF":"Chilean Unit of Account (UF)",
    "CLP":"Chilean Peso",
    "CNY":"Chinese Yuan",
    "COP":"Colombian Peso",
    "CRC":"Costa Rican Col\u00f3n",
    "CUC":"Cuban Convertible Peso",
    "CUP":"Cuban Peso",
    "CVE":"Cape Verdean Escudo",
    "CZK":"Czech Republic Koruna",
    "DJF":"Djiboutian Franc",
    "DKK":"Danish Krone",
    "DOP":"Dominican Peso",
    "DZD":"Algerian Dinar",
    "EEK":"Estonian Kroon",
    "EGP":"Egyptian Pound",
    "ERN":"Eritrean Nakfa",
    "ETB":"Ethiopian Birr",
    "EUR":"Euro",
    "FJD":"Fijian Dollar",
    "FKP":"Falkland Islands Pound",
    "GBP":"British Pound Sterling",
    "GEL":"Georgian Lari",
    "GGP":"Guernsey Pound",
    "GHS":"Ghanaian Cedi",
    "GIP":"Gibraltar Pound",
    "GMD":"Gambian Dalasi",
    "GNF":"Guinean Franc",
    "GTQ":"Guatemalan Quetzal",
    "GYD":"Guyanaese Dollar",
    "HKD":"Hong Kong Dollar",
    "HNL":"Honduran Lempira",
    "HRK":"Croatian Kuna",
    "HTG":"Haitian Gourde",
    "HUF":"Hungarian Forint",
    "IDR":"Indonesian Rupiah",
    "ILS":"Israeli New Sheqel",
    "IMP":"Manx pound",
    "INR":"Indian Rupee",
    "IQD":"Iraqi Dinar",
    "IRR":"Iranian Rial",
    "ISK":"Icelandic Kr\u00f3na",
    "JEP":"Jersey Pound",
    "JMD":"Jamaican Dollar",
    "JOD":"Jordanian Dinar",
    "JPY":"Japanese Yen",
    "KES":"Kenyan Shilling",
    "KGS":"Kyrgystani Som",
    "KHR":"Cambodian Riel",
    "KMF":"Comorian Franc",
    "KPW":"North Korean Won",
    "KRW":"South Korean Won",
    "KWD":"Kuwaiti Dinar",
    "KYD":"Cayman Islands Dollar",
    "KZT":"Kazakhstani Tenge",
    "LAK":"Laotian Kip",
    "LBP":"Lebanese Pound",
    "LKR":"Sri Lankan Rupee",
    "LRD":"Liberian Dollar",
    "LSL":"Lesotho Loti",
    "LTL":"Lithuanian Litas",
    "LVL":"Latvian Lats",
    "LYD":"Libyan Dinar",
    "MAD":"Moroccan Dirham",
    "MDL":"Moldovan Leu",
    "MGA":"Malagasy Ariary",
    "MKD":"Macedonian Denar",
    "MMK":"Myanma Kyat",
    "MNT":"Mongolian Tugrik",
    "MOP":"Macanese Pataca",
    "MRO":"Mauritanian Ouguiya",
    "MUR":"Mauritian Rupee",
    "MVR":"Maldivian Rufiyaa",
    "MWK":"Malawian Kwacha",
    "MXN":"Mexican Peso",
    "MYR":"Malaysian Ringgit",
    "MZN":"Mozambican Metical",
    "NAD":"Namibian Dollar",
    "NGN":"Nigerian Naira",
    "NIO":"Nicaraguan C\u00f3rdoba",
    "NOK":"Norwegian Krone",
    "NPR":"Nepalese Rupee",
    "NZD":"New Zealand Dollar",
    "OMR":"Omani Rial",
    "PAB":"Panamanian Balboa",
    "PEN":"Peruvian Nuevo Sol",
    "PGK":"Papua New Guinean Kina",
    "PHP":"Philippine Peso",
    "PKR":"Pakistani Rupee",
    "PLN":"Polish Zloty",
    "PYG":"Paraguayan Guarani",
    "QAR":"Qatari Rial",
    "RON":"Romanian Leu",
    "RSD":"Serbian Dinar",
    "RUB":"Russian Ruble",
    "RWF":"Rwandan Franc",
    "SAR":"Saudi Riyal",
    "SBD":"Solomon Islands Dollar",
    "SCR":"Seychellois Rupee",
    "SDG":"Sudanese Pound",
    "SEK":"Swedish Krona",
    "SGD":"Singapore Dollar",
    "SHP":"Saint Helena Pound",
    "SLL":"Sierra Leonean Leone",
    "SOS":"Somali Shilling",
    "SRD":"Surinamese Dollar",
    "STD":"S\u00e3o Tom\u00e9 and Pr\u00edncipe Dobra",
    "SVC":"Salvadoran Col\u00f3n",
    "SYP":"Syrian Pound",
    "SZL":"Swazi Lilangeni",
    "THB":"Thai Baht",
    "TJS":"Tajikistani Somoni",
    "TMT":"Turkmenistani Manat",
    "TND":"Tunisian Dinar",
    "TOP":"Tongan Pa\u02bbanga",
    "TRY":"Turkish Lira",
    "TTD":"Trinidad and Tobago Dollar",
    "TWD":"New Taiwan Dollar",
    "TZS":"Tanzanian Shilling",
    "UAH":"Ukrainian Hryvnia",
    "UGX":"Ugandan Shilling",
    "USD":"United States Dollar",
    "UYU":"Uruguayan Peso",
    "UZS":"Uzbekistan Som",
    "VEF":"Venezuelan Bol\u00edvar Fuerte",
    "VND":"Vietnamese Dong",
    "VUV":"Vanuatu Vatu",
    "WST":"Samoan Tala",
    "XAF":"CFA Franc BEAC",
    "XAG":"Silver (troy ounce)",
    "XAU":"Gold (troy ounce)",
    "XCD":"East Caribbean Dollar",
    "XDR":"Special Drawing Rights",
    "XOF":"CFA Franc BCEAO",
    "XPF":"CFP Franc",
    "YER":"Yemeni Rial",
    "ZAR":"South African Rand",
    "ZMK":"Zambian Kwacha (pre-2013)",
    "ZMW":"Zambian Kwacha",
    "ZWL":"Zimbabwean Dollar"
  }
	currencyFact = {};
	currencyFact.getCodes = function(){
		var arr = [];
		for(var key in currencyArr){
				arr.push(key);
		}
		return arr;
	}
	
	currencyFact.getCurrencies = function(){
		return currencyArr;
	}
	return currencyFact;
});


//controller
app.controller('myCtrl',['$scope', 'currencyApiFactory' ,  'currencyCodesFactory', function($scope, currencyApiFactory, currencyCodesFactory) {
    
   $scope.showResults = false;
	$scope.showLoadingIcon = false;
	//$scope.currencyCodes = {};
	$scope.selectCurrencyCodes =  currencyCodesFactory.getCurrencies();
	$scope.input = {
		targetCurr :"PKR",
		sourceCurr : "USD",
		amount : 1
	};
	console.log($scope.selectCurrencyCodes);
	
	
	$scope.getRate = function (input){
		console.log(input.targetCurr);
		 $scope.result = input.amount * (currencyApiFactory.getRate(input.targetCurr) / currencyApiFactory.getRate(input.sourceCurr));
		 $scope.result = $scope.result.toFixed(2)
		 $scope.showResults = true;
	};

	
}]);

app.controller("ratesViewCtrl",['$scope', 'currencyApiFactory', 'timeConvertFactory', 'currencyCodesFactory',
	                function($scope, currencyApiFactory, timeConvertFactory, currencyCodesFactory){
	
		$scope.countries = [];
		$scope.showLoadingIcon = true;
		var codes = 
			['USD', 'EUR', 'CAD', 'SAR', 'PKR', 'AED',  'CNY', 'JPY', 'SGD', 'BDT', 'ILS', 'IRR', 'AFN', 'TRY', 'TWD', 'MYR', 'RUB', 'UAH', 'KRW', 'IQD' ];
		$scope.lastUpdateTime = {};
		$scope.selectCurrencyCodes = {};
		$scope.selectCurrencyCodes =  currencyCodesFactory.getCurrencies();
		$scope.targetCurr = "USD";
		console.log($scope.selectCurrencyCodes);
	   var rates = currencyApiFactory.getRates().then(function(response){
			rates = response.data.quotes;
			$scope.lastUpdateTime = timeConvertFactory.convert(response.data.timestamp);
			angular.forEach(codes, function(val){
				this.push({
						code: val,
						name: currencyCodesFactory.getCurrencies()[val],
						rate: parseFloat(rates["USD" + val]).toFixed(2)
						
				})
			}, $scope.countries);
			$scope.showLoadingIcon = false;
			
		});
		
		$scope.addCurrencyBox = function (input){
			console.log(input);
			$scope.countries.push({
						code: input,
						name: currencyCodes[input],
						rate: parseFloat(rates["USD"+input]).toFixed(2)
	
				});
		};
		
		console.log($scope.countries);
}]);


app.directive('boxView', function() {
  return {
    templateUrl: 'currencyCodes.html'
  };
});
</script>

</body>
</html>